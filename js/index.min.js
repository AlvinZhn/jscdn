var screenWidth;var screenHeight;var svg;var mainBubble;var mediumBubbles=[];var smallBubbles=[];var selectedIndex=-1;var inMove=!1;var onHomeScreen=!1;var mediumBubbleData=[{'title':'About','external':0,'toggle':'#about','color':'#42aaf4',},{'title':'Resume','external':0,'toggle':'#resume','color':'#cc971e'},{'title':'Projects','external':0,'toggle':'#projects','color':'#178c2b'},{'title':'Awards','external':0,'toggle':'#awards','color':'#c13b32'}];var smallBubbleData=[{'title':'email','id':'id-email','img':"https://cdn.jsdelivr.net/gh/AlvinZhn/jscdn@master/img/contact-email.png",'link':'mailto:alvin@zhangnie.tk,alvin.zhn@gmail.com?subject=&body='},{'title':'phone','id':'id-phone','img':"https://cdn.jsdelivr.net/gh/AlvinZhn/jscdn@master/img/contact-phone.png",'link':'tel:15314942036'},{'title':'linkedin','id':'id-linkedin','img':"https://cdn.jsdelivr.net/gh/AlvinZhn/jscdn@master/img/contact-linkedin.png",'link':'https://www.linkedin.com/in/nie-zhang/'},{'title':'github','id':'id-github','img':"https://cdn.jsdelivr.net/gh/AlvinZhn/jscdn@master/img/contact-github.png",'link':'https://github.com/alvinzhn'},{'title':'<img src="https://cdn.jsdelivr.net/gh/AlvinZhn/jscdn@master/img/tim.png"/><h5>Foo.<br><small>扫一扫二维码，加我TIM。</small></h5>','id':'id-qq','img':"https://cdn.jsdelivr.net/gh/AlvinZhn/jscdn@master/img/contact-qq.png",'data-content':'<img src="https://cdn.jsdelivr.net/gh/AlvinZhn/jscdn@master/img/tim-qrcode.png"/>','link':'http://wpa.qq.com/msgrd?v=3&uin=156305905&site=qq&menu=yes'},{'title':'<img src="https://cdn.jsdelivr.net/gh/AlvinZhn/jscdn@master/img/wechat.png"/><h5>Z.Z.Z<br><small>扫一扫二维码，加我微信。</small></h5>','id':'id-wechat','img':"https://cdn.jsdelivr.net/gh/AlvinZhn/jscdn@master/img/contact-wechat.png",'data-content':'<img src="https://cdn.jsdelivr.net/gh/AlvinZhn/jscdn@master/img/wechat-qrcode.png"/>',}];function render(location){screenWidth=$('section').width();screenHeight=$(window).height();var canvas=d3.select('#contents').style('width',screenWidth);svg=canvas.append('svg').attr('width',px(screenWidth)).attr('height',px(screenHeight));generateBubbles();svg.transition().delay(100).on('end',homeScreen)};function randomOutside(){var outsideX=Math.random()>0.5;var direction=Math.random()>0.5;var distance=Math.floor((Math.random()*100)+100)+mainBubbleSize;var startLoc=Math.floor(Math.random()*(screenWidth+100))-50;if(outsideX&&direction)
return[startLoc,-distance];else if(outsideX)
return[startLoc,screenHeight+distance];else if(direction)
return[screenWidth+distance,startLoc];else return[-distance,startLoc]};function generateBubbles(){var loc=randomOutside();mainBubble=svg.append('image').attr('xlink:href',"https://cdn.jsdelivr.net/gh/AlvinZhn/jscdn@master/img/profile.png").attr('x',loc[0]).attr('y',loc[1]).attr('width',mainBubbleSize).attr('height',mainBubbleSize).on('click',function(){history.pushState(null,null,'/');homeScreen()});for(var i=0;i<mediumBubbleData.length;i++){var loc=randomOutside();var bubble=svg.append('circle').attr('cx',loc[0]).attr('cy',loc[1]).attr('r',(mediumBubbleSize/2)).attr('bubbleIndex',i).attr('class','mediumBubble').attr('external',mediumBubbleData[i].external).attr('toggle',mediumBubbleData[i].toggle).style('fill',mediumBubbleData[i].color);mediumBubbles.push(bubble);bubble.on('click',function(){if(d3.select(this).attr('external')==1)
window.open(d3.select(this).attr('toggle'),'_blank');else{bubbleClicked(d3.select(this).attr('bubbleIndex'),d3.select(this).attr('toggle'))}})}
for(var i=0;i<smallBubbleData.length;i++){var loc=randomOutside();var img=svg.append('image').attr('xlink:href',smallBubbleData[i].img).attr('x',loc[0]).attr('y',loc[1]).attr('link',smallBubbleData[i].link).attr('id',smallBubbleData[i].id).attr('title',smallBubbleData[i].title).attr('data-content',smallBubbleData[i]['data-content']).attr('class','smallBubble').attr('width',smallBubbleSize).attr('height',smallBubbleSize);smallBubbles.push(img);img.on('click',function(){if(this.id!='id-wechat'){window.open(d3.select(this).attr('link'),'_blank')}})}};var labels=[];function homeScreen(){if(onHomeScreen)
return;onHomeScreen=!0;inMove=!0;selectedIndex=-1;d3.selectAll('.sections').transition().delay(transitionTime).style('display','none');mainBubble.transition().duration(transitionTime).attr('x',(screenWidth/2)-(mainBubbleSize/2)).attr('y',(screenHeight/2)-(mainBubbleSize/2)).attr('width',mainBubbleSize).attr('height',mainBubbleSize);for(var i=0;i<mediumBubbles.length;i++){var bubble=mediumBubbles[i];var angle=(2*i+1)*(Math.PI/(2*mediumBubbles.length+1))+Math.PI/2+(Math.PI/(4*mediumBubbles.length+1));var transition=bubble.transition().duration(transitionTime).attr('cx',(screenWidth/2)-Math.sin(angle)*outerRadius).attr('cy',(screenHeight/2)+Math.cos(angle)*outerRadius).attr('r',mediumBubbleSize/2).on('end',function(){animateMediumBubble(d3.select(this))});if(labels.length!==mediumBubbleData.length){var headline=svg.append('text').attr('x',(screenWidth/2)-Math.sin(angle)*outerRadius).attr('y',(screenHeight/2)+Math.cos(angle)*outerRadius-5).attr('class','mediumBubbleText').style('font-family',lato).style('font-weight','bold').style('alignment-baseline','hanging').style('text-anchor','middle').style('font-size',headlineSize).style('fill','#000000').style('pointer-events','none').style('opacity',0).text(mediumBubbleData[i].title);labels.push(headline);headline.transition().duration(transitionTime).delay(transitionTime/2).style('opacity',1)}else{labels[i].transition().duration(transitionTime).attr('x',(screenWidth/2)-Math.sin(angle)*outerRadius).attr('y',(screenHeight/2)+Math.cos(angle)*outerRadius-5).style('font-size',headlineSize)}}
for(var i=0;i<smallBubbles.length;i++){var img=smallBubbles[i];var angle=(2*i+1)*(Math.PI/(2*smallBubbles.length+1))-Math.PI/2+(Math.PI/(4*smallBubbles.length+1));var transition=img.transition().duration(transitionTime).attr('x',(screenWidth/2)+Math.sin(angle)*innerRadius-(smallBubbleSize/2)).attr('y',(screenHeight/2)+Math.cos(angle)*innerRadius-(smallBubbleSize/2)).on('end',function(){animateSmallBubble(d3.select(this))})}
svg.transition().duration(transitionTime).attr('height',screenHeight).on('end',animatePoints);animateMainBubble()}
function animateMediumBubble(bubble){function animate(){if(!onHomeScreen)
return;bubble.transition().duration(bubbleGrowTime).ease(d3.easeQuad).attr('r',(mediumBubbleSize/2)*bubbleGrowRatio).transition().duration(bubbleGrowTime).ease(d3.easeQuad).attr('r',(mediumBubbleSize/2)).on('end',animate)}
animate()}
function animateSmallBubble(bubble){function animate(){bubble.transition().duration(bubbleGrowTime).ease(d3.easeQuad).attr('width',smallBubbleSize*bubbleGrowRatio).attr('height',smallBubbleSize*bubbleGrowRatio).attr('transform','translate('+(-((bubbleGrowRatio-1)*smallBubbleSize)/2)+', '+(-((bubbleGrowRatio-1)*smallBubbleSize)/2)+')').transition().ease(d3.easeQuad).attr('width',smallBubbleSize).attr('height',smallBubbleSize).attr('transform','').on('end',animate)}
animate()}
function animatePoints(){inMove=!1;d3.selectAll('.mediumBubble').on('mouseover',function(){if(inMove)return;if(selectedIndex==d3.select(this).attr('bubbleIndex'))return;var originalSize=onHomeScreen?(mediumBubbleSize/2):(mediumBubbleSmallSize/2);d3.select(this).transition().duration(hoverTime).attr('r',originalSize*bubbleGrowRatioLarge);if(onHomeScreen)
labels[d3.select(this).attr('bubbleIndex')].transition().duration(hoverTime).style('opacity',1).style('font-size',headlineGrowSize)}).on('mouseout',function(){if(inMove)return;if(selectedIndex==d3.select(this).attr('bubbleIndex'))return;var originalSize=onHomeScreen?(mediumBubbleSize/2):(mediumBubbleSmallSize/2);d3.select(this).transition().duration(hoverTime).attr('r',originalSize).on('end',function(){animateMediumBubble(d3.select(this))});if(onHomeScreen)
labels[d3.select(this).attr('bubbleIndex')].transition().duration(hoverTime).style('font-size',headlineSize)});d3.selectAll('.smallBubble').on('mouseover',function(d){if(inMove)return;if(this.id=='id-wechat'||this.id=='id-qq'){if(onHomeScreen){options.placement='top'}else{options.placement='bottom'}
showPopover.call(this,d,options)}
d3.select(this).transition().duration(hoverTime).attr('width',smallBubbleSize*bubbleGrowRatioLarge).attr('height',smallBubbleSize*bubbleGrowRatioLarge).attr('transform','translate('+(-((bubbleGrowRatioLarge-1)*smallBubbleSize)/2)+', '+(-((bubbleGrowRatioLarge-1)*smallBubbleSize)/2)+')')}).on('mouseout',function(){if(inMove)return;if(this.id=='id-wechat'||this.id=='id-qq'){$(this).popover('destroy')}
d3.select(this).transition().attr('width',smallBubbleSize).attr('height',smallBubbleSize).attr('transform','').on('end',animatePoints)});checkLocation()}
function bubbleClicked(index,toggle){selectedIndex=index;inMove=!0;onHomeScreen=!1;mainBubble.transition().duration(transitionTime).attr('x',2*padding).attr('y',2*padding).attr('width',mainBubbleSmallSize).attr('height',mainBubbleSmallSize);mediumBubbles[selectedIndex].transition().duration(transitionTime).attr('cx',3*padding+3*mainBubbleSmallSize/2).attr('cy',2*padding+mainBubbleSmallSize/2).attr('r',mainBubbleSmallSize/2);labels[selectedIndex].transition().duration(transitionTime).attr('x',3*padding+3*mainBubbleSmallSize/2).attr('y',2*padding+mainBubbleSmallSize/2-5).style('font-size',headlineSizeSmall);history.pushState(null,null,mediumBubbleData[selectedIndex].toggle);var x=4*padding+2*mainBubbleSmallSize+mediumBubbleSmallSize/2;var y=2*padding+mainBubbleSmallSize/2;for(var i=0;i<mediumBubbles.length;i++){if(i==selectedIndex)
continue;mediumBubbles[i].transition().duration(transitionTime).attr('cx',x).attr('cy',y).attr('r',mediumBubbleSmallSize/2);labels[i].transition().duration(transitionTime).attr('x',x).attr('y',y-5).style('font-size',headlineSizeTiny);x+=padding+mediumBubbleSmallSize}
var left=!0;var height=padding;for(var i=0;i<smallBubbles.length;i++){var x=left?screenWidth-2*padding-2*smallBubbleSize:screenWidth-padding-smallBubbleSize;var y=height;smallBubbles[i].transition().duration(transitionTime).attr('x',x).attr('y',y);left=!left;if(left)
height+=padding+smallBubbleSize}
d3.selectAll('.sections').style('display','none');$(mediumBubbleData[index].toggle).fadeIn(1000)
svg.transition().duration(transitionTime).attr('height',padding+(smallBubbleData.length/2)*(smallBubbleSize+padding)+20).on('end',function(){inMove=!1})}
function animateMainBubble(){mainBubble.on('mouseover',function(){if(inMove)return;if(selectedIndex==-1)return;mainBubble.transition().duration(hoverTime).attr('x',padding).attr('y',padding).attr('width',mainBubbleSmallSize*bubbleGrowRatioMed).attr('height',mainBubbleSmallSize*bubbleGrowRatioMed)}).on('mouseout',function(){if(inMove)return;if(selectedIndex==-1)return;var originalSize=onHomeScreen?mainBubbleSize:mainBubbleSmallSize;mainBubble.transition().duration(hoverTime).attr('x',2*padding).attr('y',2*padding).attr('width',mainBubbleSmallSize).attr('height',mainBubbleSmallSize)})}
function px(x){return x+'px'}
function pxtonum(x){return parseInt(x.substring(0,x.length-2))}
var options={html:!0,container:'body',trigger:'manual',placement:'auto',}
function showPopover(d,options){$(this).popover(options);$(this).popover('show')}
var aboutOnClick=function(){$('#id-footer-about').on('click',function(){bubbleClicked(0)})}
var scrollToAnchor=function(id){var target=$(id)
$('html,body').animate({scrollTop:target.offset().top},800)}
var anchorOnClick=function(){$('.index_anchor').on('click',function(){if(window.location.hash=='#projects'){scrollToAnchor($(this).attr('href'))}else{bubbleClicked(2)
setTimeout(function(){scrollToAnchor($(this).attr('href'))},1000)}})}
var checkLocation=function(){var anchors=['#web_framework','#todo_list','#flask','#web_socket','#crawler']
if(window.location.hash!=''){if(anchors.indexOf(window.location.hash)!=-1){var current_anchor=window.location.hash
bubbleClicked(2)
setTimeout(function(){scrollToAnchor(current_anchor)},1000)}else{for(let index=0;index<mediumBubbleData.length;index++){if(mediumBubbleData[index].toggle==window.location.hash){bubbleClicked(index)}}}}}
if(window.innerWidth<550){var padding=10*0.6;var mainBubbleSize=200*0.6;var mediumBubbleSize=120*0.6;var smallBubbleSize=42*0.6;var outerRadius=220*0.6;var innerRadius=150*0.6;var headlineSize=24*0.6;var headlineGrowSize=30*0.6;var headlineSizeSmall=20*0.6;var headlineSizeTiny=15*0.6;var mainBubbleSmallSize=100*0.6;var mediumBubbleSmallSize=70*0.6}else{var padding=10;var mainBubbleSize=200;var mediumBubbleSize=120;var smallBubbleSize=42;var outerRadius=220;var innerRadius=150;var headlineSize=24;var headlineGrowSize=30;var headlineSizeSmall=20;var headlineSizeTiny=15;var mainBubbleSmallSize=100;var mediumBubbleSmallSize=70}
var bubbleGrowRatio=1.05;var bubbleGrowRatioMed=1.15;var bubbleGrowRatioLarge=1.3;var hoverTime=200;var transitionTime=1000;var bubbleGrowTime=1000;var merriweather='"Merriweather", serif';var lato='"Lato", sans-serif';window.onload=function(){render();$("html,body").animate({scrollTop:80},1000);aboutOnClick();anchorOnClick();!function(window){var $q=function(q,res){if(document.querySelectorAll){res=document.querySelectorAll(q)}else{var d=document,a=d.styleSheets[0]||d.createStyleSheet();a.addRule(q,'f:b');for(var l=d.all,b=0,c=[],f=l.length;b<f;b++)
l[b].currentStyle.f&&c.push(l[b]);a.removeRule(0);res=c}
return res},addEventListener=function(evt,fn){window.addEventListener?this.addEventListener(evt,fn,!1):(window.attachEvent)?this.attachEvent('on'+evt,fn):this['on'+evt]=fn},_has=function(obj,key){return Object.prototype.hasOwnProperty.call(obj,key)};function loadImage(el,fn){var img=new Image(),src=el.getAttribute('data-src');img.onload=function(){if(!!el.parent)
el.parent.replaceChild(img,el)
else el.src=src;fn?fn():null}
img.src=src}
function elementInViewport(el){var rect=el.getBoundingClientRect()
return(window.location.hash=='#projects'&&rect.top>=0&&rect.left>=0&&rect.top<=(window.innerHeight||document.documentElement.clientHeight))}
var images=new Array(),query=$q('img.lazy'),processScroll=function(){for(var i=0;i<images.length;i++){if(elementInViewport(images[i])){loadImage(images[i],function(){images.splice(i,i)})}}};for(var i=0;i<query.length;i++){images.push(query[i])};processScroll();addEventListener('scroll',processScroll)}(this)}