var log=function(){console.log.apply(console,arguments)},e=function(e){return document.querySelector(e)},ajax=function(e,n,a,t){var o=new XMLHttpRequest;o.open(e,n,!0),o.setRequestHeader("Content-Type","application/json"),o.onreadystatechange=function(){4===o.readyState&&t(o.response)},a=JSON.stringify(a),o.send(a)},htmlEncode=function(e){return $("<span/>").text(e).html()},htmlDecode=function(e){return $("<span/>").html(e).text()},strEncode=function(e){return 0==e.length?"":e.replace(/\./g,"&46").replace(/ /g,"&32").replace(/\\/g,"&92").replace(/\//g,"&47").replace(/\'/g,"'").replace(/\"/g,'"').replace(/\n/g,"<br>")},strDecode=function(e){return 0==e.length?"":e.replace(/\&46/g,".").replace(/\&32/g," ").replace(/\&92/g,"\\").replace(/\&47/g,"/")};function show_toggle(e){if(null!=e)e=$(e).parent().next();else e=$(".nav-bottom .container .nav-menu");"none"==e.css("display")?e.css("display","block"):e.css("display","none")}var toggle_active=function(){$(window).width()<768&&$(".nav-dropdown button").attr("onclick","show_toggle(this);");var e=window.location.pathname.split("/")[1];"@"==e[0]&&(e="profile");var n=["chat","crawler","mashup","discuss"],a=["todo","weibo","blog","finance"],t=["message","settings","admin","profile"],o=n.indexOf(e),i=a.indexOf(e),s=(["douban","mtime","renting","job"].indexOf(e),t.indexOf(e));o>-1?($(`.nav-${n[o]}`).addClass("active is-active"),"crawler"==n[o]&&$(`.dropdown-${window.location.pathname.split("/")[2]}`).addClass("active is-active")):i>-1?($(".nav-catalog").addClass("active is-active"),$(`.dropdown-${a[i]}`).addClass("active is-active")):s>-1&&$(`.nav-dropdown-${t[s]}`).addClass("active is-active")};function flash(e){var n=`\n        <div class="flash notification is-primary for-user wow fadeIn" data-wow-delay=".5s" style="white-space:nowrap">\n            <a href="#" class="notification-body inherits-color" target="_blank">\n                ${e}\n            </a>\n        </div>\n        `;document.querySelector("body").insertAdjacentHTML("beforeEnd",n);var a=$(window).width();setTimeout(`$('.flash').animate({left:"${a}"},800);`,3e3),setTimeout("$('.flash').remove();",3800)}var apiLogin=function(e,n){ajax("POST","/api/login",e,n)},apiRegister=function(e,n){ajax("POST","/api/register",e,n)},apiMessageCounter=function(e){ajax("GET","/api/message/counter","",e)},notificationTemplate=function(){return template={alarm:'\n        <li>\n            <button id="user-notifications-toggle" class="button is-naked">\n                <svg id="icon-alarm" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">\n                    <path d="M0 0h24v24H0V0z" fill="none"></path> <path d="M10.01 21.01c0 1.1.89 1.99 1.99 1.99s1.99-.89 1.99-1.99h-3.98zm8.87-4.19V11c0-3.25-2.25-5.97-5.29-6.69v-.72C13.59 2.71 12.88 2 12 2s-1.59.71-1.59 1.59v.72C7.37 5.03 5.12 7.75 5.12 11v5.82L3 18.94V20h18v-1.06l-2.12-2.12zM16 13.01h-3v3h-2v-3H8V11h3V8h2v3h3v2.01z"></path>\n                </svg>\n            </button>\n        </li>\n    '},template},messageCounterChange=function(e){var n=parseInt($(".nav-dropdown-message .tag").text());if(0==n&&e>0){var a=notificationTemplate();$(".message-notify").prepend(a.alarm),$(".nav-dropdown-message .tag").text(e),$(".nav-dropdown-message .tag").css("display","flex")}else 0!=n&&e>0?$(".nav-dropdown-message .tag").text(e):0!=n&&0==e&&($("#user-notifications-toggle").remove(),$(".nav-dropdown-message .tag").text(e),$(".nav-dropdown-message .tag").css("display","none"))},bindEventFootBtn=function(){$(".go-top").on("click",function(){$("html,body").animate({scrollTop:0},500)}),$(".qrcode").hover(function(){$("#bottom-qrcode").css("display","block")},function(){$("#bottom-qrcode").css("display","none")}),"/contact"==window.location.pathname&&$(".fixed-btn").css("display","none")},bindEventSignIn=function(){$("#id-login").validator().on("submit",function(e){if(e.isDefaultPrevented());else{e.preventDefault();var n=$("#id-login button"),a=$("#id-login-username").val(),t=$("#id-login-password").val();if(a.length>0&&t.length>0)$(n).addClass("is-loading"),$(n).next().remove(),apiLogin({username:a,password:t},function(e){var a=JSON.parse(e);0==a.error.length?location.reload():(error_message=`\n                        <div class="control">\n                            <span class="help is-danger">\n                            ${a.error}\n                            </span>\n                        </div>\n                        `,$(n).parent()[0].insertAdjacentHTML("beforeEnd",error_message),$(n).removeClass("is-loading"))})}})},bindEventRegister=function(){$("#id-register").on("click",function(){$(".username").css("display","none"),$(".email").css("display","none")}),$("#id-register").validator().on("submit",function(e){if(e.isDefaultPrevented());else{e.preventDefault();var n=$("#id-username").val(),a=$("#id-email").val(),t=$("#id-password").val(),o=($("#id-passwordConfirm").val(),{username:n,email:a,password:t}),i=$("#id-register button");$(i).addClass("is-loading"),apiRegister(o,function(e){var n=JSON.parse(e);$(i).removeClass("is-loading"),n.error.length>0?(error="."+n.error,$(error).css("display","block"),$(error).prev().addClass("glyphicon-remove"),$(error).parent().addClass("has-error")):window.location=n.redirect})}})},wow=function(e){null==e&&(e={mobile:!1}),new WOW(e).init()},bindEventMessageCounter=function(){apiMessageCounter(function(e){var n=JSON.parse(e),a=parseInt(n.counter);messageCounterChange(a)})},bindEventCloseNotify=function(){window.onbeforeunload=function(){return"quit?"}};$(document).ready(function(){wow(),toggle_active(),bindEventFootBtn(),bindEventSignIn(),bindEventRegister(),null!=$(".nav-right img").prop("alt")&&bindEventMessageCounter()});